---
driver:
  name: docker
  hostname: kitchen-salt.ci.local
  use_sudo: false
  socket:  'unix:///var/run/docker.sock' 
  provision_command:
    - pip install --upgrade pip
    - pip  install pytest
    - mkdir -p /run/sshd
provisioner:
  name: salt_solo
  salt_install: bootstrap
  salt_version: latest
  salt_bootstrap_url: https://bootstrap.saltstack.com
  salt_bootstrap_options: -X -p git -p curl -p sudo
  formula: .
  require_chef: false
  gpg_key: test@example.com
  gpg_home: gpgkeys
  cache_commands:
    - touch /tmp/cache_commands_test
  init_environment: |
    mkdir -p /home/kitchen/var/cache/salt/master
  salt_copy_filter:
    - .filter_hidden
  additional_copy_path:
      - "."
  #dependencies:
    #- name: foo
    #  path: ./modules/mysudo
    #- name: nginx
    #  repo: apt
    #  package: salt-formula-nginx
  state_top:
    base:
      "*":
        - mysudo
  pillars:
    top.sls:
      base:
        "*":
          - git
  pillars_from_directories:
  - source:  pillars/
    dest: srv/pillar/
  grains:
    noservices: True

platforms:
   - name: docker-salt
     driver:
       image: docker-salt:latest
       platform: ubuntu
#  - name: ubuntu-18.04
#    driver:
#      run_command: '/usr/sbin/sshd -D -o UseDNS=no -o UsePAM=no -o PasswordAuthentication=yes -o PidFile=/tmp/sshd.pid'
#    provisioner:
#      salt_apt_repo: 'https://repo.saltstack.com/apt/ubuntu/18.04/amd64/'
#      salt_apt_repo_key: 'https://repo.saltstack.com/apt/ubuntu/18.04/amd64/latest/SALTSTACK-GPG-KEY.pub'
#      init_environment: |
#        sudo mkdir -p /tmp/kitchen/var/cache/salt/master
#        sudo apt-get update
#        DEBIAN_FRONTEND=noninteractive sudo apt-get install -y software-properties-common
#      salt_bootstrap_options: -X -p git -p curl -p sudo -p software-properties-common
#  - name: ubuntu-16.04
#    provisioner:
#      init_environment: |
#        sudo mkdir -p /tmp/kitchen/var/cache/salt/master
#        sudo apt-get update
#        DEBIAN_FRONTEND=noninteractive sudo apt-get install -y software-properties-common
#      salt_bootstrap_options: -X -p git -p curl -p sudo -p software-properties-common
#  - name: centos-7
#    driver_config:
#      provision_command:
#        - yum install -y epel-release
#        - yum install -y python-pip python-devel gcc git gcc-c++
#    provisioner:
#      salt_yum_repo: 'https://repo.saltstack.com/yum/redhat/$releasever/$basearch/%s'
#      salt_yum_rpm_key: 'https://repo.saltstack.com/yum/redhat/7/x86_64/latest/SALTSTACK-GPG-KEY.pub'
#  - name: centos-6
#    provisioner:
#      salt_yum_repo: 'https://repo.saltstack.com/yum/redhat/$releasever/$basearch/%s'
#      salt_yum_rpm_key: 'https://repo.saltstack.com/yum/redhat/6/x86_64/latest/SALTSTACK-GPG-KEY.pub'
#      pip_bin: pip2.7
#    driver_config:
#      provision_command:
#        - yum install -y epel-release https://centos6.iuscommunity.org/ius-release.rpm
#        - yum install -y python27-pip python27-devel gcc git gcc-c++
suites:
   - name: basic
     default_pattern: true
     env_vars:
       TARGET_HOST: 127.0.0.1
       SUDO: false
verifier:
  name: shell
  remote_exec: false
  command: >
    pytest --color=yes -v   "test/integration/"
